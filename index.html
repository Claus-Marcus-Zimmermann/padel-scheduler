<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Padel Doubles Scheduler</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
}
.container {
    max-width: 900px;
    margin: auto;
    padding: 16px;
}
h1 { text-align: center; }
.section {
    background: white;
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 6px;
}
label { display: block; margin-top: 8px; }
input, select, button {
    padding: 8px;
    margin-top: 4px;
    width: 100%;
}
button {
    background: #007aff;
    color: white;
    border: none;
    border-radius: 4px;
}
button.secondary {
    background: #888;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
}
th, td {
    border-bottom: 1px solid #ddd;
    padding: 6px;
    text-align: center;
}
.small { font-size: 0.85em; color: #555; }
</style>
</head>
<body>

<div class="container">
<h1>Padel Doubles Scheduler</h1>

<div class="section">
<h3>Players</h3>
<input id="playerName" placeholder="Add player name">
<button onclick="addPlayer()">Add Player</button>
<ul id="playerList"></ul>
</div>

<div class="section">
<h3>Settings</h3>
<label>Session start time
<input type="time" id="startTime"></label>

<label>Game duration (minutes)
<input type="number" id="gameDuration"></label>

<label>Changeover duration (minutes)
<input type="number" id="changeDuration"></label>

<label>Randomness
<select id="mode">
<option value="fun">Fun random</option>
<option value="fair">Fair random</option>
</select>
</label>
</div>

<div class="section">
<button onclick="generateRound()">Generate Next Round</button>
<button class="secondary" onclick="deleteLast()">Delete Last Round</button>
</div>

<div class="section">
<h3>History</h3>
<table>
<thead>
<tr>
<th>Session</th>
<th>Date</th>
<th>Start</th>
<th>End</th>
<th>Team A</th>
<th>Team B</th>
<th>Sit Out</th>
</tr>
</thead>
<tbody id="history"></tbody>
</table>
</div>
</div>

<script>
const LS_PLAYERS = 'padel_players';
const LS_ROUNDS = 'padel_rounds';
const LS_SETTINGS = 'padel_settings';

let players = JSON.parse(localStorage.getItem(LS_PLAYERS)) || [];
let rounds = JSON.parse(localStorage.getItem(LS_ROUNDS)) || [];
let settings = JSON.parse(localStorage.getItem(LS_SETTINGS)) || {
    startTime: '18:00',
    game: 20,
    change: 5,
    mode: 'fun'
};

document.getElementById('startTime').value = settings.startTime;
document.getElementById('gameDuration').value = settings.game;
document.getElementById('changeDuration').value = settings.change;
document.getElementById('mode').value = settings.mode;

function saveSettings() {
    settings = {
        startTime: startTime.value,
        game: +gameDuration.value,
        change: +changeDuration.value,
        mode: mode.value
    };
    localStorage.setItem(LS_SETTINGS, JSON.stringify(settings));
}

['startTime','gameDuration','changeDuration','mode'].forEach(id =>
    document.getElementById(id).addEventListener('change', saveSettings)
);

function addPlayer() {
    const name = playerName.value.trim();
    if (!name) return;
    players.push(name);
    localStorage.setItem(LS_PLAYERS, JSON.stringify(players));
    playerName.value = '';
    renderPlayers();
}

function renderPlayers() {
    playerList.innerHTML = '';
    players.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p;
        playerList.appendChild(li);
    });
}

function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
}

function generateRound() {
    if (players.length < 4) return alert('Need at least 4 players');

    const prev = rounds[rounds.length - 1];
    let session = prev ? prev.session : 1;

    let start = prev
        ? new Date(prev.end)
        : new Date(`${new Date().toDateString()} ${settings.startTime}`);

    if (prev && start < new Date(prev.start)) {
        session++;
        start = new Date(`${new Date().toDateString()} ${settings.startTime}`);
    }

    const end = new Date(start.getTime() + settings.game * 60000);

    let pool = [...players];
    shuffle(pool);

    const active = pool.slice(0, 4);
    const sitOut = pool.slice(4);

    const round = {
        session,
        date: start.toISOString().slice(0,10),
        start: start.toISOString(),
        end: end.toISOString(),
        teamA: active.slice(0,2),
        teamB: active.slice(2,4),
        sitOut
    };

    rounds.push(round);
    localStorage.setItem(LS_ROUNDS, JSON.stringify(rounds));
    renderHistory();
}

function deleteLast() {
    rounds.pop();
    localStorage.setItem(LS_ROUNDS, JSON.stringify(rounds));
    renderHistory();
}

function renderHistory() {
    history.innerHTML = '';
    [...rounds]
        .sort((a,b) =>
            b.date.localeCompare(a.date) ||
            new Date(a.start) - new Date(b.start)
        )
        .forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
            <td>${r.session}</td>
            <td>${r.date.split('-').reverse().join('-')}</td>
            <td>${new Date(r.start).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</td>
            <td>${new Date(r.end).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</td>
            <td>${r.teamA.join(' & ')}</td>
            <td>${r.teamB.join(' & ')}</td>
            <td class="small">${r.sitOut.join(', ')}</td>`;
            history.appendChild(tr);
        });
}

renderPlayers();
renderHistory();
</script>

</body>
</html>
